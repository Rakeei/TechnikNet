{% extends "admin/change_list.html" %}

{% block search %}
{{ block.super }}

<!-- ⭐ اضافه کردن Per Page Selector -->
<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
    <form method="get" id="perPageForm" style="display: inline-block;">
        <!-- حفظ تمام پارامترهای فعلی -->
        {% for key, value in request.GET.items %}
            {% if key != 'per_page' %}
            <input type="hidden" name="{{ key }}" value="{{ value }}">
            {% endif %}
        {% endfor %}
        
        <label for="perPageSelect" style="font-weight: bold; margin-right: 10px;">
            <i class="bi bi-list-ol"></i> Items per page:
        </label>
        <select name="per_page" id="perPageSelect" 
                style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px;"
                onchange="this.form.submit();">
            <option value="50" {% if current_per_page == '50' %}selected{% endif %}>50</option>
            <option value="100" {% if current_per_page == '1000' %}selected{% endif %}>1000</option>
            <option value="500" {% if current_per_page == '2000' %}selected{% endif %}>2000</option>
            <option value="all" {% if current_per_page == 'all' %}selected{% endif %}>Show All (max 10000)</option>
            <option value="custom" {% if current_per_page not in '50,100,500,all' %}selected{% endif %}>Custom...</option>
        </select>
        
        <span id="customPerPageInput" style="display: none; margin-left: 10px;">
            <input type="number" name="per_page_custom" id="perPageCustom" 
                   placeholder="Enter number (1-10000)" min="1" max="10000"
                   value="{% if current_per_page not in '50,1000,2000,all' %}{{ current_per_page }}{% endif %}"
                   style="padding: 5px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
            <button type="button" onclick="applyCustomPerPage()" 
                    style="padding: 5px 15px; background: #417690; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Apply
            </button>
        </span>
    </form>
    
    <span style="margin-left: 20px; color: #666;">
        Showing {{ cl.result_count }} propert{{ cl.result_count|pluralize:"y,ies" }}
    </span>
</div>

<script>
document.getElementById('perPageSelect').addEventListener('change', function() {
    const customInput = document.getElementById('customPerPageInput');
    if (this.value === 'custom') {
        customInput.style.display = 'inline-block';
        document.getElementById('perPageCustom').focus();
    } else {
        customInput.style.display = 'none';
    }
});

function applyCustomPerPage() {
    const customValue = document.getElementById('perPageCustom').value;
    if (customValue) {
        const select = document.getElementById('perPageSelect');
        select.value = customValue;
        document.getElementById('perPageForm').submit();
    }
}

// نمایش custom input اگر مقدار custom وارد شده
window.addEventListener('DOMContentLoaded', function() {
    const currentPerPage = '{{ current_per_page }}';
    const standardValues = ['50', '1000', '2000', 'all'];
    if (!standardValues.includes(currentPerPage)) {
        document.getElementById('customPerPageInput').style.display = 'inline-block';
    }
});
</script>
{% endblock %}
